<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Secure Hax Chat üîê</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
/* ==================================== */
/* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∏ –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã */
/* ==================================== */
:root {
  --bg-color: linear-gradient(135deg, #2c003e, #5a006a, #ff5aab);
  --glass-bg: rgba(255, 255, 255, 0.1);
  --text-color: #f5f5f5;
  --header-color: #ffd6f7;
  --accent-color: #ff5aab;
  --button-gradient: linear-gradient(90deg, #ff5aab, #8a2be2);
  --success-color: #4CAF50;
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg-color);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: var(--text-color);
  margin:0; padding:0;
  transition: background 0.3s ease;
  position: relative;
}

h1 { margin-top: 24px; font-size: 2rem; color: var(--header-color); text-shadow: 0 2px 8px rgba(0,0,0,0.5);}
.container { width: 90%; max-width: 800px; margin: 16px auto; padding-bottom: 50px; z-index: 100;}
.card { background: var(--glass-bg); border-radius: 16px; padding: 20px; margin-bottom: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.4); backdrop-filter: blur(4px); transition: transform 0.2s, box-shadow 0.2s;}
.card:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0,0,0,0.6);}
textarea, input { width: 100%; box-sizing: border-box; margin: 6px 0; padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: #fff; font-family: 'Roboto Mono', monospace; font-size: 0.95rem;}
button { background: var(--button-gradient); color: #fff; border: none; border-radius: 12px; padding: 12px 18px; margin-top: 8px; cursor: pointer; font-weight: 600; transition: transform 0.2s, box-shadow 0.3s, filter 0.2s; white-space: nowrap;}
button:hover { background: linear-gradient(90deg, #ff75c4, #a64ddb); transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.5); filter: brightness(1.1);}
button:active { transform: translateY(0); box-shadow: 0 4px 12px rgba(0,0,0,0.4);}
pre { background: var(--glass-bg); padding: 10px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; color: #fff; font-family: 'Roboto Mono', monospace;}
.row { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
.flex-col { display:flex; flex-direction:column;}
/* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ—É—Ç–µ—Ä –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è Sans */
footer {
  width:100%;
  text-align:center;
  margin:24px 0;
  padding-bottom: 20px;
  position: relative;
  z-index: 100;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.footer-links {
    display: flex;
    justify-content: center;
    align-items: flex-end; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ –Ω–∏–∑—É */
    gap: 15px;
    position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è Sans */
    width: auto;
}
a { color: var(--accent-color); text-decoration: none; transition: color 0.2s;}
a:hover { color: #fff;}

/* ==================================== */
/* –°–ê–ù–° / –ò–ù–¢–ï–†–ê–ö–¢–ò–í */
/* ==================================== */
#sans-image {
  /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ, –Ω–µ–∑–∞–º–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ: –≤ —Ñ—É—Ç–µ—Ä–µ, —Ä—è–¥–æ–º —Å –¢–µ–ª–µ–≥—Ä–∞–º–æ–º */
  width: 40px;
  height: 40px;
  cursor: pointer;
  border-radius: 50%;
  transition: transform 0.2s ease-out;
  box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); /* –î–æ–±–∞–≤–∏–º –ª–µ–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
  background-color: rgba(255, 255, 255, 0.1); /* –õ–µ–≥–∫–∏–π —Ñ–æ–Ω */
  margin-bottom: -15px; /* –ü–æ–¥–Ω–∏–º–µ–º –µ–≥–æ –∫ Telegram –∏–∫–æ–Ω–∫–µ */
}

#sans-image:hover {
  transform: scale(1.1) rotate(5deg);
  filter: none; /* –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ - —è—Ä–∫–∏–π Sans! */
}

#socks-message {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  padding: 20px 40px;
  background: rgba(0, 0, 0, 0.9);
  color: #fff000; /* –ñ–µ–ª—Ç—ã–π —Ü–≤–µ—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
  font-size: 2.5rem;
  font-family: 'Roboto Mono', monospace;
  border: 5px solid #ff5aab;
  box-shadow: 0 0 30px #ff5aab;
  border-radius: 10px;
  z-index: 3000;
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  pointer-events: none;
  text-align: center;
}
#socks-message.active {
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ (–ò–∑–º–µ–Ω–µ–Ω—ã –¥–ª—è –≤—ã–ª–µ—Ç–∞ —Å –±–æ–∫–æ–≤) */
#confetti-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2500;
  overflow: hidden;
}
.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  opacity: 0;
  animation-duration: 3s;
  animation-fill-mode: forwards;
  animation-timing-function: cubic-bezier(.17,.67,.83,.67);
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –≤—ã–ª–µ—Ç–∞ —Å –±–æ–∫–æ–≤ */
@keyframes fall-left {
  0% { left: 0; top: 50%; transform: translate(-100%, -50%) rotate(0deg); opacity: 1; }
  100% { left: 50%; top: 100vh; transform: translate(-50%, 0) rotate(720deg); opacity: 0; }
}
@keyframes fall-right {
  0% { right: 0; top: 50%; transform: translate(100%, -50%) rotate(0deg); opacity: 1; }
  100% { right: 50%; top: 100vh; transform: translate(50%, 0) rotate(-720deg); opacity: 0; }
}

/* ==================================== */
/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
/* ==================================== */

#menu-btn {
  position: fixed;
  top: 15px;
  left: 15px;
  z-index: 2000;
  width: auto;
  min-width: 90px;
  height: 50px;
  font-size: 1.1rem;
  padding: 0 15px;
  border-radius: 25px;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  color: var(--header-color);
  display: flex;
  align-items: center;
  justify-content: center;
}
#nav-menu {
  position: fixed;
  top: 70px;
  left: 15px;
  z-index: 1999;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 15px;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  transform: translateX(-150%);
  opacity: 0;
  transition: transform 0.3s ease-out, opacity 0.3s ease-out;
}
#nav-menu.active {
  transform: translateX(0);
  opacity: 1;
}
#nav-menu button {
  width: 150px;
  padding: 10px 15px;
  background: rgba(255, 255, 255, 0.1);
  box-shadow: none;
  border-radius: 10px;
}
#nav-menu button.active {
  background: var(--button-gradient);
}
#nav-menu button:hover {
  transform: none;
  box-shadow: 0 0 10px var(--accent-color);
}
.page {
  display: none;
  width: 100%;
  animation: fadeIn 0.5s ease-out;
}
.page.active {
  display: block;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
#home-page {
    background:
        radial-gradient(circle 400px at 50% 10%, rgba(255, 90, 171, 0.1), transparent),
        radial-gradient(circle 300px at 80% 90%, rgba(138, 43, 226, 0.1), transparent),
        repeating-linear-gradient(0deg, #2c003e, #2c003e 1px, transparent 1px, transparent 100px),
        repeating-linear-gradient(90deg, #2c003e, #2c003e 1px, transparent 1px, transparent 100px);
    background-color: #330044;
    padding-top: 20px;
    text-align: center;
}
#home-page h2 { color: var(--accent-color); font-size: 1.5rem; border-bottom: 2px solid var(--accent-color); padding-bottom: 5px; display: inline-block;}
#home-page p { line-height: 1.6; text-align: left; margin-bottom: 20px;}
.skeleton-joke {
    background: var(--glass-bg);
    padding: 15px;
    border-radius: 10px;
    margin: 20px 0;
    border-left: 5px solid var(--accent-color);
    font-style: italic;
    color: var(--header-color);
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    text-align: left;
}
.skeleton-joke strong { color: lime; }
.img-grid { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 30px;}
.img-hacker {
  width: 150px;
  height: 150px;
  background: #333;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.6);
  transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Roboto Mono', monospace;
  font-size: 1.2rem;
  overflow: hidden;
  position: relative;
}
.img-hacker i {
    font-size: 3rem;
    color: var(--success-color);
    text-shadow: 0 0 10px var(--success-color);
    z-index: 2;
}
.img-hacker span {
    position: absolute;
    bottom: 5px;
    font-size: 0.9rem;
    color: #fff;
    z-index: 2;
}
.img-hacker:before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 1;
}
.img-hacker:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px var(--accent-color);
}
/* *** –ò–ó–ú–ï–ù–ï–ù–ò–ï –°–¢–ò–õ–ï–ô –î–õ–Ø –ú–ï–ú-–†–ï–ñ–ò–ú–ê *** */
/* –£–±—Ä–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫—Ä–æ–º–µ —Ñ–æ–Ω–∞ –∏ —Å–∞–º–æ–≥–æ MEME_PAGE_CONTENT */
.meme-mode > .container,
.meme-mode #menu-btn,
.meme-mode #nav-menu,
.meme-mode footer {
    display: none;
}
.meme-mode {
    background: black !important;
    transition: background 0.1s;
}
/* *** –ö–û–ù–ï–¶ –ò–ó–ú–ï–ù–ï–ù–ò–ô –°–¢–ò–õ–ï–ô *** */

#meme-page-content {
    /* –°—Ç–∏–ª—å –¥–ª—è —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ body */
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: green;
    font-size: 2rem;
    font-family: 'Roboto Mono', monospace;
    z-index: 1000;
    text-shadow: 0 0 10px green, 0 0 20px green;
    overflow: hidden;
    pointer-events: none;
    padding: 20px;
}
.meme-bg-text {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: red;
    opacity: 0.1;
    font-size: 10vmin;
    line-height: 1.2;
    pointer-events: none;
    font-family: 'Roboto Mono', monospace;
    z-index: 999;
    user-select: none;
    padding: 10px;
}
#toast-container { position: fixed; top:20px; right:20px; z-index:9999;}
.toast { background: rgba(255,255,255,0.2); color: #fff; padding: 10px 16px; margin-top: 8px; border-radius: 10px; box-shadow:0 4px 12px rgba(0,0,0,0.5); backdrop-filter: blur(3px); font-weight:500; transition: opacity 0.3s ease, transform 0.3s ease; opacity:0; transform: translateY(-20px);}

</style>
</head>
<body>

<button id="menu-btn" onclick="toggleMenu()">‚â° Menu</button>
<nav id="nav-menu">
  <button data-page="home" class="active">–ì–ª–∞–≤–Ω–∞—è</button>
  <button data-page="chat">–ß–∞—Ç</button>
  <button data-page="meme">–ú–µ–º</button>
</nav>

<div class="container">
  <div id="home-page" class="page active">
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Secure Hax Chat üîê</h1>

    <div id="socks-message">–Ø –Ω–µ —É–±—Ä–∞–ª –Ω–æ—Å–∫–∏!</div>
    <div id="confetti-container"></div>

    <div class="skeleton-joke">
        "–ü–æ—á–µ–º—É –°–∫–µ–ª–µ—Ç –Ω–µ –ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º —á–∞—Ç–æ–º? –ü–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–µ–≥–æ –Ω–µ—Ç –∫–∏—à–æ–∫, —á—Ç–æ–±—ã –¥–µ–ª–∏—Ç—å—Å—è –∏–º–∏! <strong>Secure Hax</strong> ‚Äì —á–∞—Ç, –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ –¥–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ –∫–æ—Å—Ç–∏."
    </div>

    <div class="card">
      <h2>üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –í–∞—à–∏—Ö –î–∞–Ω–Ω—ã—Ö</h2>
      <p>
        –í –º–∏—Ä–µ, –≥–¥–µ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–≤–µ—Ä–≥–∞–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —É–≥—Ä–æ–∑–µ, –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ —Ä–æ—Å–∫–æ—à—å—é, –∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å—é. –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç <strong>–≤—ã—Å–æ–∫–æ–Ω–∞–¥–µ–∂–Ω—É—é –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—É—é –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—é (TweetNaCl)</strong> –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ç–æ–≥–æ, —á—Ç–æ –≤–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤–∞–º –∏ –≤–∞—à–µ–º—É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É.
      </p>

      <h3>–ü–æ—á–µ–º—É —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ?</h3>
      <p>
        –í–∞—à–∏ –∫–ª—é—á–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ **–ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (localStorage)**. –ú—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –≤–∞—à–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∞ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –Ω–∏–∫—Ç–æ, –≤–∫–ª—é—á–∞—è –Ω–∞—Å, –Ω–µ –∏–º–µ–µ—Ç –∫ –Ω–∏–º –¥–æ—Å—Ç—É–ø–∞.
      </p>

      <h3>–ö–∞–∫ –Ω–∞—á–∞—Ç—å?</h3>
      <p>
        –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ß–∞—Ç". –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø–∞—Ä—É –∫–ª—é—á–µ–π. –û–±–º–µ–Ω—è–π—Ç–µ—Å—å **–ø—É–±–ª–∏—á–Ω—ã–º** –∫–ª—é—á–æ–º —Å –≤–∞—à–∏–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–º, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–±–º–µ–Ω –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.
      </p>

      <div class="img-grid">
        <div class="img-hacker">
          <i class="fas fa-key"></i>
          <span>–ö–ª—é—á–∏</span>
        </div>
        <div class="img-hacker">
          <i class="fas fa-lock-open"></i>
          <span>–û–±–º–µ–Ω</span>
        </div>
        <div class="img-hacker">
          <i class="fas fa-shield-alt"></i>
          <span>–ó–∞—â–∏—Ç–∞</span>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>üóÇÔ∏è –ù–∞—à–∞ –§–∏–ª–æ—Å–æ—Ñ–∏—è –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h2>
      <p>
        –ú—ã –≤–µ—Ä–∏–º, —á—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ–π. –ù–∞—à –∫–æ–¥ ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–π, –∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ TweetNaCl, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–≤–Ω–æ –ø—Ä–∏–∑–Ω–∞–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º). –ú—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å: —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –∫–ª—é—á–∏, –æ–±–º–µ–Ω—è–ª—Å—è –ø—É–±–ª–∏—á–Ω—ã–º ‚Äî –∏ —Ç—ã —É–∂–µ –≤ –∫—Ä–∏–ø—Ç–æ-–±—É–Ω–∫–µ—Ä–µ. **–ù–∏–∫–∞–∫–∏—Ö –±—ç–∫–¥–æ—Ä–æ–≤, —Ç–æ–ª—å–∫–æ —Å–∫–µ–ª–µ—Ç—ã –∏ –Ω–∞–¥–µ–∂–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞.**
      </p>
    </div>

    <div class="skeleton-joke">
        "–°–µ–∫—Ä–µ—Ç —Ö–æ—Ä–æ—à–µ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è? –ö–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä–µ–ø–∫–∏–º–∏, –∞ –∞–ª–≥–æ—Ä–∏—Ç–º - –Ω–µ–ø—Ä–æ–±–∏–≤–∞–µ–º—ã–º! <strong>(–≠—Ç–æ –Ω–µ —Å–∞—Ä–∫–∞–∑–º, —ç—Ç–æ TweetNaCl.)</strong>"
    </div>

    <div class="card">
        <h2>‚ú® –ß—Ç–æ –¥–∞–ª—å—à–µ?</h2>
        <p>
            –ú—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –í –±—É–¥—É—â–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ–º –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–º–µ–Ω–∞ —Ñ–∞–π–ª–∞–º–∏ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ SOCKS. –ù–æ –ø–æ–∫–∞ —á—Ç–æ, –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å —Å–∞–º—ã–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏ –Ω–µ–º–Ω–æ–≥–æ —Å—Ç—Ä–∞–Ω–Ω—ã–º —á–∞—Ç–æ–º –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ!
        </p>
    </div>

    <div class="skeleton-joke">
        "–•–∞–∫–µ—Ä-—Å–∫–µ–ª–µ—Ç –∑–∞—à–µ–ª –≤ —á–∞—Ç. –ï–º—É –≥–æ–≤–æ—Ä—è—Ç: '–ü—Ä–∏–≤–µ—Ç!'. –ê –æ–Ω –≤ –æ—Ç–≤–µ—Ç: '–ü—Ä–æ—Å—Ç–æ **–∫–æ—Å—Ç–∏**!'"
    </div>

  </div>

  <div id="chat-page" class="page">
    <h1>Secure Chat 2.0 üîê</h1>
    <div class="card">
      <h2>1Ô∏è‚É£ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—É –∫–ª—é—á–µ–π</h2>
      <button id="resetBtn">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
      <button id="gen">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏</button>
      <div id="pubArea" style="display:none" class="flex-col">
        <label>–í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:</label>
        <textarea id="myPub" rows="3" readonly></textarea>
        <button id="copyPub">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
        <div>–û—Ç–ø–µ—á–∞—Ç–æ–∫ (SHA-256, 16 –±–∞–π—Ç hex): <code id="myFp"></code></div>
      </div>
    </div>

    <div class="card">
      <h2>2Ô∏è‚É£ –í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞</h2>
      <textarea id="peerPub" rows="3" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á"></textarea>
      <button id="importPeer" disabled>–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
      <div>–û—Ç–ø–µ—á–∞—Ç–æ–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞: <code id="peerFp"></code></div>
    </div>

    <div class="card">
      <h2>3Ô∏è‚É£ –®–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h2>
      <textarea id="plain" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"></textarea>
      <button id="encryptBtn" disabled>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
      <label>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:</label>
      <textarea id="cipherout" rows="3" readonly></textarea>
      <button id="copyCipher">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ</button>
    </div>

    <div class="card">
      <h2>4Ô∏è‚É£ –î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h2>
      <textarea id="cipherin" rows="3" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É"></textarea>
      <button id="decryptBtn" disabled>–î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
      <label>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</label>
      <textarea id="plainout" rows="3" readonly></textarea>
    </div>
  </div>


  <div id="meme-page" class="page"></div>
</div>

<div id="toast-container"></div>
<footer>
    <div class="footer-links">
        <img id="sans-image"
             src="https://avatanplus.com/files/resources/mid/57b39ece5502b15695a4560c.png"
             onclick="activateSansMeme(event)">
        <a href="https://t.me/securehaxchat" target="_blank" title="Telegram">
            <i class="fab fa-telegram fa-2x"></i>
        </a>
    </div>
    <small style="margin-top: 10px;">
        ¬© 2025 Secure Hax Inc. | <a href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
    </small>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tweetnacl/1.0.3/tweetnacl.min.js"></script>
<script>
// ====================================
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
// ====================================

const state = {
  activePage: 'home',
  memeClicks: 0,
  isMemeActive: false,
  isSansActive: false,
};

const pages = document.querySelectorAll('.page');
const navButtons = document.querySelectorAll('#nav-menu button');
const menuBtn = document.getElementById('menu-btn');
const navMenu = document.getElementById('nav-menu');
const toastContainer = document.getElementById('toast-container');

function toggleMenu() {
  navMenu.classList.toggle('active');
  menuBtn.textContent = navMenu.classList.contains('active') ? '‚úñ Close' : '‚â° Menu';
}

function showPage(pageId) {
  state.activePage = pageId;
  pages.forEach(page => {
    if (page.id !== pageId + '-page') {
        page.classList.remove('active');
    }
  });

  navButtons.forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('data-page') === pageId) {
      btn.classList.add('active');
    }
  });

  const currentPage = document.getElementById(pageId + '-page');
  if (currentPage) {
    currentPage.classList.add('active');
  }

  if (pageId === 'meme') {
    enterMemeMode();
  } else {
    exitMemeMode();
  }
}

navButtons.forEach(button => {
  button.addEventListener('click', (e) => {
    const pageId = e.target.getAttribute('data-page');
    showPage(pageId);
    toggleMenu();
  });
});

function showToast(message, duration = 3000) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    toastContainer.appendChild(toast);

    setTimeout(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateY(0)';
    }, 10);

    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(-20px)';
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, duration);
}


// ====================================
// –°–ê–ù–° / –ò–ù–¢–ï–†–ê–ö–¢–ò–í (–û–î–ò–ù –ö–õ–ò–ö)
// ====================================

const SANS_IMAGE = document.getElementById('sans-image');
const SANS_MESSAGE = document.getElementById('socks-message');
const CONFETTI_CONTAINER = document.getElementById('confetti-container');

const CONFETTI_COLORS = ['#ff0000', '#ffff00', '#0000ff', '#ff5aab'];

function createConfetti(count) {
    for (let i = 0; i < count; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.backgroundColor = CONFETTI_COLORS[Math.floor(Math.random() * CONFETTI_COLORS.length)];
        confetti.style.left = (Math.random() < 0.5 ? 0 : 100) + 'vw';
        confetti.style.top = Math.random() * 100 + 'vh';
        confetti.style.width = Math.random() * 10 + 5 + 'px';
        confetti.style.height = confetti.style.width;

        confetti.style.animationName = (i % 2 === 0) ? 'fall-left' : 'fall-right';
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        confetti.style.animationDuration = Math.random() * 2 + 3 + 's';

        CONFETTI_CONTAINER.appendChild(confetti);

        confetti.addEventListener('animationend', () => {
            confetti.remove();
        });
    }
}

function activateSansMeme(event) {
    if (state.activePage !== 'home') return;

    if (state.isSansActive) {
        showToast('...—Ç—ã —É–∂–µ —Å–¥–µ–ª–∞–ª —Å–≤–æ–π –≤—ã–±–æ—Ä.', 1000);
        return;
    }

    state.isSansActive = true;

    createConfetti(100);

    SANS_MESSAGE.classList.add('active');

    setTimeout(() => {
        SANS_MESSAGE.classList.remove('active');
        showToast('...–∏ —ç—Ç–æ –º–æ—è –ø–æ—Å–ª–µ–¥–Ω—è—è —à—É—Ç–∫–∞.', 2500);
    }, 2000);
}

SANS_IMAGE.addEventListener('click', activateSansMeme);


// ====================================
// –ú–ï–ú-–†–ï–ñ–ò–ú (–§–û–ù)
// ====================================

const MEME_TEXT_CONTENT = "HAX LO L SOCKS HAXXOR MEME HAXOR LOL SHCURE HAX LOL MEME HAXOR SKUL SOCKS HAX LOL SCURE HAX MEME LOL";
let memeInterval;
let memeBgText;
let memePageContent;

function createMemeBg() {
    memeBgText = document.createElement('div');
    memeBgText.className = 'meme-bg-text';
    document.body.appendChild(memeBgText);
}

function updateMemeBg() {
    if (!memeBgText) return;

    let content = "";
    for (let i = 0; i < 200; i++) {
        const text = MEME_TEXT_CONTENT.split(' ')[Math.floor(Math.random() * MEME_TEXT_CONTENT.split(' ').length)];
        content += text + " ".repeat(Math.floor(Math.random() * 5) + 1);
    }
    memeBgText.textContent = content;
}

function enterMemeMode() {
    if (state.isMemeActive) return;
    state.isMemeActive = true;
    document.body.classList.add('meme-mode');
    if (!memeBgText) createMemeBg();
    updateMemeBg();
    memeInterval = setInterval(updateMemeBg, 100);

    memePageContent = document.createElement('div');
    memePageContent.id = 'meme-page-content';
    memePageContent.innerHTML = `
        <h1>LOADING HACKER.EXE...</h1>
        <p>1337 HAX ACTIVATED. SECURITY IS FOR NOOBS.</p>
    `;
    document.body.appendChild(memePageContent);
}

function exitMemeMode() {
    if (!state.isMemeActive) return;
    state.isMemeActive = false;
    document.body.classList.remove('meme-mode');
    clearInterval(memeInterval);

    if (memeBgText) {
        memeBgText.remove();
        memeBgText = null;
    }
    if (memePageContent) {
        memePageContent.remove();
        memePageContent = null;
    }
}


// ====================================
// –ö–†–ò–ü–¢–û–ì–†–ê–§–ò–Ø (TWEETNACL) - –ü–û–ß–ò–ù–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê
// ====================================

const myPubTextarea = document.getElementById('myPub');
const peerPubTextarea = document.getElementById('peerPub');
const cipherOutTextarea = document.getElementById('cipherout');
const plainOutTextarea = document.getElementById('plainout');
const plainTextarea = document.getElementById('plain');

const copyPubBtn = document.getElementById('copyPub');
const importPeerBtn = document.getElementById('importPeer');
const encryptBtn = document.getElementById('encryptBtn');
const decryptBtn = document.getElementById('decryptBtn');
const genBtn = document.getElementById('gen');
const resetBtn = document.getElementById('resetBtn');

const myFpCode = document.getElementById('myFp');
const peerFpCode = document.getElementById('peerFp');

let keyPair = null;
let peerPubKey = null;

// –•–µ–ª–ø–µ—Ä: Uint8Array -> Hex String
function u8ToHex(arr) {
    return Array.from(arr).map(b => b.toString(16).padStart(2, '0')).join('');
}

// –•–µ–ª–ø–µ—Ä: Hex String -> Uint8Array
function hexToU8(hex) {
    if (hex.length % 2 !== 0) throw new Error("Invalid hex string length");
    const arr = new Uint8Array(hex.length / 2);
    for (let i = 0; i < hex.length; i += 2) {
        arr[i / 2] = parseInt(hex.substring(i, i + 2), 16);
    }
    return arr;
}

// –•–µ–ª–ø–µ—Ä: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ—Ç–ø–µ—á–∞—Ç–∫–∞ (Fingerprint - –ø–µ—Ä–≤—ã–µ 16 –±–∞–π—Ç SHA-256)
async function getFingerprint(key) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫—Ä–∏–ø—Ç–æ-API
    if (typeof crypto === 'undefined' || !crypto.subtle) {
         return 'Crypto API not available';
    }
    if (!key) return '';
    try {
        const hashBuffer = await crypto.subtle.digest('SHA-256', key);
        const hashArray = new Uint8Array(hashBuffer);
        return u8ToHex(hashArray.slice(0, 16)); // 16 –±–∞–π—Ç (32 hex —Å–∏–º–≤–æ–ª–∞)
    } catch(e) {
        console.error("Failed to generate fingerprint:", e);
        return 'Error calculating fingerprint';
    }
}

// –•–µ–ª–ø–µ—Ä: ArrayBuffer -> String (–¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ LocalStorage)
function arrayBufferToBase64(buffer) {
    return btoa(String.fromCharCode(...new Uint8Array(buffer)));
}

// –•–µ–ª–ø–µ—Ä: String -> ArrayBuffer
function base64ToArrayBuffer(base64) {
    const binary_string = atob(base64);
    const len = binary_string.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
        bytes[i] = binary_string.charCodeAt(i);
    }
    return bytes.buffer;
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–µ–π –∏–∑ localStorage
function loadKeys() {
    const storedPub = localStorage.getItem('myPubKey');
    const storedSec = localStorage.getItem('mySecKey');

    if (storedPub && storedSec) {
        try {
            keyPair = {
                publicKey: new Uint8Array(base64ToArrayBuffer(storedPub)),
                secretKey: new Uint8Array(base64ToArrayBuffer(storedSec))
            };
            myPubTextarea.value = u8ToHex(keyPair.publicKey);
            updateUI();
            getFingerprint(keyPair.publicKey).then(fp => myFpCode.textContent = fp);
            showToast('–ö–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞!', 2000);
        } catch (e) {
            console.error("Error loading keys from storage:", e);
            showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–ª—é—á–µ–π. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ.', 3000);
            localStorage.removeItem('myPubKey');
            localStorage.removeItem('mySecKey');
            updateUI();
        }
    } else {
        updateUI();
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function updateUI() {
    const hasKeys = !!keyPair;
    const hasPeer = !!peerPubKey;

    document.getElementById('pubArea').style.display = hasKeys ? 'flex' : 'none';

    // –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
    encryptBtn.disabled = !(hasKeys && hasPeer && plainTextarea.value.length > 0);
    decryptBtn.disabled = !hasKeys;
    importPeerBtn.disabled = peerPubTextarea.value.length === 0;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ø–µ—á–∞—Ç–∫–æ–≤
    if (hasKeys) {
        myPubTextarea.value = u8ToHex(keyPair.publicKey);
        getFingerprint(keyPair.publicKey).then(fp => myFpCode.textContent = fp);
    } else {
        myPubTextarea.value = '';
        myFpCode.textContent = '–ù–µ—Ç –∫–ª—é—á–∞';
    }

    if (hasPeer) {
        getFingerprint(peerPubKey).then(fp => peerFpCode.textContent = fp);
    } else {
        peerFpCode.textContent = '–ù–µ—Ç –∫–ª—é—á–∞';
    }
}

// ====================================
// –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
// ====================================

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
genBtn.addEventListener('click', () => {
    // **–í–ê–ñ–ù–û:** nacl.box.keyPair() –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω
    if (!window.nacl || !nacl.box) {
         showToast('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 3000);
         return;
    }

    keyPair = nacl.box.keyPair();
    const pubHex = u8ToHex(keyPair.publicKey);
    const secBase64 = arrayBufferToBase64(keyPair.secretKey.buffer);

    localStorage.setItem('myPubKey', arrayBufferToBase64(keyPair.publicKey.buffer));
    localStorage.setItem('mySecKey', secBase64);

    myPubTextarea.value = pubHex;
    showToast('–ù–æ–≤–∞—è –ø–∞—Ä–∞ –∫–ª—é—á–µ–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 3000);
    updateUI();
});

// –°–±—Ä–æ—Å
resetBtn.addEventListener('click', () => {
    localStorage.clear();
    keyPair = null;
    peerPubKey = null;
    peerPubTextarea.value = '';
    cipherOutTextarea.value = '';
    plainOutTextarea.value = '';
    plainTextarea.value = '';
    showToast('–í—Å–µ –∫–ª—é—á–∏ –∏ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã.', 3000);
    updateUI();
});

// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
copyPubBtn.addEventListener('click', () => {
    if (keyPair) {
        myPubTextarea.select();
        document.execCommand('copy');
        showToast('–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 1500);
    }
});

// –ò–º–ø–æ—Ä—Ç –∫–ª—é—á–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
importPeerBtn.addEventListener('click', () => {
    const hex = peerPubTextarea.value.trim();
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã: 32 –±–∞–π—Ç–∞ = 64 hex —Å–∏–º–≤–æ–ª–∞
    if (hex.length === 64) {
        try {
            peerPubKey = hexToU8(hex);
            showToast('–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω.', 2000);
            updateUI();
        } catch (e) {
            showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è 64 Hex —Å–∏–º–≤–æ–ª–∞).', 3000);
            peerPubKey = null;
            updateUI();
        }
    } else {
        showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è 64 Hex —Å–∏–º–≤–æ–ª–∞).', 3000);
        peerPubKey = null;
        updateUI();
    }
});

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–ª—è –∫–ª—é—á–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
peerPubTextarea.addEventListener('input', () => {
    importPeerBtn.disabled = peerPubTextarea.value.trim().length === 0;
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º peerPubKey, –µ—Å–ª–∏ –ø–æ–ª–µ –æ—á–∏—â–µ–Ω–æ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–æ
    if (peerPubTextarea.value.trim().length === 0) {
        peerPubKey = null;
        updateUI();
    }
});

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–ª—è –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
plainTextarea.addEventListener('input', () => {
    encryptBtn.disabled = !(keyPair && peerPubKey && plainTextarea.value.length > 0);
});

// –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
encryptBtn.addEventListener('click', () => {
    if (!keyPair || !peerPubKey) {
        showToast('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ –∫–ª—é—á–∏ –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞.', 3000);
        return;
    }
    if (!window.nacl || !nacl.box) {
         showToast('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 3000);
         return;
    }

    const plaintext = plainTextarea.value;
    const nonce = nacl.randomBytes(nacl.box.nonceLength);
    const messageUint8 = nacl.util.encodeUTF8(plaintext);

    try {
        const encrypted = nacl.box(
            messageUint8,
            nonce,
            peerPubKey,
            keyPair.secretKey
        );

        // –°–æ–±–∏—Ä–∞–µ–º –≤ —Å—Ç—Ä–æ–∫—É: Nonce (24 –±–∞–π—Ç–∞) + Ciphertext
        const fullMessage = new Uint8Array(nonce.length + encrypted.length);
        fullMessage.set(nonce);
        fullMessage.set(encrypted, nonce.length);

        cipherOutTextarea.value = u8ToHex(fullMessage);
        showToast('–°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ!', 2000);
    } catch (e) {
        showToast('–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏.', 3000);
        console.error("Encryption error:", e);
    }
});

// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
document.getElementById('copyCipher').addEventListener('click', () => {
    if (cipherOutTextarea.value) {
        cipherOutTextarea.select();
        document.execCommand('copy');
        showToast('–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 1500);
    }
});


// –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
decryptBtn.addEventListener('click', () => {
    if (!keyPair) {
        showToast('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ –∫–ª—é—á–∏.', 3000);
        return;
    }
    if (!window.nacl || !nacl.box) {
         showToast('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 3000);
         return;
    }

    const cipherHex = document.getElementById('cipherin').value.trim();
    if (cipherHex.length < (nacl.box.nonceLength + nacl.box.overheadLength) * 2) {
        showToast('–ù–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö.', 3000);
        plainOutTextarea.value = '–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è.';
        return;
    }

    try {
        const fullMessage = hexToU8(cipherHex);
        const nonce = fullMessage.slice(0, nacl.box.nonceLength);
        const encrypted = fullMessage.slice(nacl.box.nonceLength, fullMessage.length);

        // –ö–ª—é—á –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (peerPub) - —ç—Ç–æ –Ω–∞—à –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á,
        // –µ—Å–ª–∏ –æ–Ω —à–∏—Ñ—Ä–æ–≤–∞–ª –¥–ª—è –Ω–∞—Å.
        // **–í–ê–ñ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à –ü–†–ò–í–ê–¢–ù–´–ô –∫–ª—é—á**
        // **–∏ –ü–£–ë–õ–ò–ß–ù–´–ô –∫–ª—é—á –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø (–∫–æ—Ç–æ—Ä—ã–π –º—ã –∑–¥–µ—Å—å –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º).**
        // **–ù–æ —Å–æ–≥–ª–∞—Å–Ω–æ –ª–æ–≥–∏–∫–µ nacl.box.open, –µ—Å–ª–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à –∫–ª—é—á,**
        // **—Ç–æ –≤—Ç–æ—Ä—ã–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ (—Ç–æ–≥–æ, –∫—Ç–æ –®–ò–§–†–û–í–ê–õ).**

        // –í –¥–∞–Ω–Ω–æ–º –¥–∏–∑–∞–π–Ω–µ (–µ—Å–ª–∏ –º—ã –¥–µ—à–∏—Ñ—Ä—É–µ–º —Ç–æ, —á—Ç–æ –Ω–∞–º –ü–†–ò–°–õ–ê–õ–ò),
        // –Ω–∞–º –Ω—É–∂–µ–Ω: –Ω–∞—à SecretKey –∏ PublickKey –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø.
        // –ù–û, –¢–ê–ö –ö–ê–ö –í–ê–® –ö–û–î –ò–°–ü–û–õ–¨–ó–£–ï–¢: –Ω–∞—à SecretKey –∏ –ù–ê–® PublicKey (peerPub = keyPair.publicKey),
        // —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ "—Å–∞–º –¥–ª—è —Å–µ–±—è" –∏–ª–∏
        // —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ù–ê–® public key, –∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ù–ê–® public key
        // –ø—Ä–∏ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–∏, —á—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ –Ω–µ–≤–µ—Ä–Ω–æ –¥–ª—è –æ–±–º–µ–Ω–∞.

        // **–í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ò–°–•–û–î–ù–û–ô –õ–û–ì–ò–ö–ò (–µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ —Ç–∞–∫–æ–π):**
        // –ï—Å–ª–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç "–æ—Ç –Ω–∞—Å –∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É" (Enc): (–Ω–∞—à Sec + –µ–≥–æ Pub)
        // –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "–æ—Ç —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –∫ –Ω–∞–º" (Dec): (–∏—Ö Sec + –Ω–∞—à Pub)
        // –¢–∞–∫ –∫–∞–∫ –º—ã –Ω–µ –∏–º–µ–µ–º –∏—Ö Sec, nacl box.open —Ç—Ä–µ–±—É–µ—Ç: (–Ω–∞—à Sec + –∏—Ö Pub)

        // **–í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê:** –ú—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ø–æ–ª–µ
        // "–í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞" (peerPubTextarea)
        // –≤—Å—Ç–∞–≤–ª—è–µ—Ç –∫–ª—é—á **—Ç–æ–≥–æ, –∫—Ç–æ —à–∏—Ñ—Ä–æ–≤–∞–ª –¥–ª—è –Ω–µ–≥–æ** (–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è).
        // –ï—Å–ª–∏ —ç—Ç–æ —Ç–∞–∫, —Ç–æ –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω–∞ –ø–∞—Ä–∞:
        // (–Ω–∞—à SecretKey) –∏ (PublicKey –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø) - –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –≤ `peerPubKey`.

        // **–ï—Å–ª–∏ peerPubKey –ø—É—Å—Ç, –º—ã –Ω–µ –º–æ–∂–µ–º –¥–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å.**
        if (!peerPubKey) {
            showToast('–î–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —É–∫–∞–∂–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –≤ –ø–æ–ª–µ 2.', 4000);
            plainOutTextarea.value = '–û—à–∏–±–∫–∞: –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω.';
            return;
        }

        const decrypted = nacl.box.open(
            encrypted,
            nonce,
            peerPubKey, // Public Key –û–¢–ü–†–ê–í–ò–¢–ï–õ–Ø
            keyPair.secretKey // –ù–∞—à Secret Key
        );

        if (decrypted) {
            plainOutTextarea.value = nacl.util.encodeUTF8(decrypted);
            showToast('–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ!', 2000);
        } else {
            showToast('–î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å. –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ.', 3000);
            plainOutTextarea.value = '–û—à–∏–±–∫–∞: –î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å. –í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ.';
        }
    } catch (e) {
        showToast('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.', 3000);
        plainOutTextarea.value = '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.';
        console.error("Decryption error:", e);
    }
});


// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', () => {
  // –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  loadKeys();
  showPage('home'); // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–º–∞—à–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
});

</script>
</body>
</html>
